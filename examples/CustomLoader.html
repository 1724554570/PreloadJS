<!DOCTYPE html>
<html>
<head>
	<title>PreloadJS: Manifest Loader</title>

	<link href="../_assets/css/shared.css" rel="stylesheet" type="text/css"/>
	<link href="../_assets/css/examples.css" rel="stylesheet" type="text/css"/>
	
	<style type="text/css">
		#template {
			display:none;
		}
	</style>
</head>
<body onload="init()">

	<header id="header" class="PreloadJS">
	    <h1><span class="text-product">Preload<strong>JS</strong></span> Custom Loader</h1>
	    <p></p>
	</header>

    <script type="text/javascript" src="../lib/preloadjs-NEXT.combined.js"></script>

    <script type="text/javascript">

        (function() {

            function CustomLoader(item) {
                this.AbstractLoader_constructor(item, false, "loader");
                this.img = null;
            }

            // Static Plugin Methods
            CustomLoader.getPreloadHandlers = function() {
                return {
                    types: ["image"],
                    callback: CustomLoader.preloadHandler
                };
            };
            CustomLoader.preloadHandler = function(src) {
                var loader = new CustomLoader(src);
                loader.on("complete", CustomLoader.handleComplete, CustomLoader);
                return {
                    loader: loader
                }
            };
            CustomLoader.handleComplete = function(event) {
                var img = event.result;
                img.width = img.height = 200;
            };

            // Loader Methods
            var p = createjs.extend(CustomLoader, createjs.AbstractLoader);
            p.load = function() {
                this.img = new Image();
                this.img.onload = createjs.proxy(this.handleLoad, this);
                this.img.src = this._item.src;
            };
            p.handleLoad = function() {
                this._result = this.img;
                this._sendComplete();
            };
            window.CustomLoader = createjs.promote(CustomLoader, "AbstractLoader");

        }())


        function init() {
            if (window.top != window) {
                document.getElementById("header").style.display = "none";
            }

            var loader = new createjs.LoadQueue();
            loader.installPlugin(CustomLoader);
            loader.loadFile("../_assets/art/Autumn.png")
            //loader.loadManifest({src:"../_assets/static/manifest.json", callback:"loadManifest"});
            loader.on("fileload", handleFileLoad);
            loader.on("progress", handleProgress);
            loader.load();
        }

        function handleFileLoad(event) {
            console.log(event);
            document.body.appendChild(event.result);
        }

        function handleProgress(event) {
            console.log("PROGRESS", event.progress);
        }

    </script>

</body>
</html>
